var k=Object.defineProperty;var D=(o,t,e)=>t in o?k(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var O=(o,t,e)=>(D(o,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill.b7f2da20.js";import{A as G,a as F,f as M,i as N,l as $,o as T,p as U,r as A,q as H,v as Z,g as b,c as q,s as C,u as R,t as j,w as B,x as K,b as X,y as Y}from"./vendor.1dc52be5.js";/* empty css             */let _=null;function z(o,t){const e=document.createElement("calcite-action");e.icon=o,e.addEventListener("click",()=>Q(t)),document.getElementById("action-bar").appendChild(e)}function Q(o){_&&_.remove(),_=o()}const m=new G({portalItem:{id:"7a4ce32df4774997bbb32f230efbe7cc"}}),f=new F,s=new F,v=new F,y=3,P=[100,130,180],h=new M({symbolLayers:[new N({material:{color:P},edges:new $({size:"1px",color:[50,50,50]}),size:y})]}),W=new M({symbolLayers:[new N({material:{color:P},edges:new $({size:"1px",color:[255,255,255]}),size:y})]}),V=new M({symbolLayers:[new T({outline:{size:"2px",color:"white"}})]});function oo(o){z("group-x",()=>(t.create("polygon"),{remove(){t.cancel()}})),m.modifications=new U,o.map.add(f);const t=new A({view:o,layer:f,defaultUpdateOptions:{tool:"reshape",reshapeOptions:{edgeOperation:"offset"}},polygonSymbol:V});f.graphics.on("change",()=>L()),t.on("create",e=>{e.state==="start"&&f.removeAll()}),t.on("update",e=>{e.state==="complete"&&L()})}function L(){var t,e;m.modifications.removeAll();const o=(t=f.graphics.getItemAt(0))==null?void 0:t.geometry;((e=o==null?void 0:o.rings)==null?void 0:e[0].length)>2&&m.modifications.add(new H({geometry:o,type:"replace"}))}const E="customized-editing-state";class eo{constructor(){O(this,"_modification",null);O(this,"_floors",[]);this._load()}get modification(){return this._modification}set modification(t){this._modification=t,this._save()}get floors(){return this._floors}set floors(t){this._floors=t.slice(),this._save()}_load(){const t=localStorage.getItem(E);if(!t)return;const e=JSON.parse(t);this._modification=e.modification?H.fromJSON(e.modification):null,this._floors=e.floors?e.floors.map(n=>Z.fromJSON(n)):[]}_save(){var t,e;localStorage.setItem(E,JSON.stringify({modification:(e=(t=this._modification)==null?void 0:t.toJSON())!=null?e:null,floors:this._floors.map(n=>n.toJSON())}))}}const d=new eo;function to(){no(),io()}function no(){d.modification&&(m.modifications.add(d.modification),f.add(new b({geometry:d.modification.geometry,symbol:V}))),m.modifications.on("change",()=>{d.modification=m.modifications.getItemAt(0)})}function io(){for(const o of d.floors)s.add(new b({geometry:o,symbol:h}));q(()=>s.graphics.map(o=>o.geometry).toArray(),o=>d.floors=o)}let u;function ro(o){z("urban-model-",()=>(u.create("polygon"),{remove(){u.cancel()}})),o.map.add(s),u=new A({view:o,layer:s,polygonSymbol:h,defaultUpdateOptions:{tool:"reshape",reshapeOptions:{edgeOperation:"offset"}}})}function ao(){u.snappingOptions=new C({featureSources:[{layer:s}],enabled:!0})}let i=null,l=[];function so(o){z("export-",()=>{const e=new R;return e.add([co(o),mo(o,t,()=>e.removeAll())]),{remove(){e.destroy(),t.cancel(),i=null,l.length=0}}}),o.map.add(v);const t=new A({view:o,layer:v,defaultUpdateOptions:{enableRotation:!1,enableScaling:!1,tool:"move"}});t.on("update",e=>{var c;if(e.state==="complete"){v.removeAll(),l.length=0;return}if(!i)return;const n=(c=i.geometry)==null?void 0:c.rings[0][0][2],r=e.graphics[0].geometry.z,a=Math.max(0,Math.floor((r-n)/y)-1);for(a<l.length&&(s.removeMany(l.slice(a)),l.length=a);l.length<a;){const p=i.geometry.clone(),w=n+(l.length+1)*y;lo(p,w);const g=new b({geometry:p,symbol:h});l.push(g),s.add(g)}})}function lo(o,t){for(const e of o.rings)for(const n of e)n[2]=t}function co(o){const t=o.on("pointer-move",async e=>{var c;const{results:n}=await o.hitTest(e),r=(c=n[0])==null?void 0:c.graphic,a=(r==null?void 0:r.layer)===s?r:null;a!==i&&(i&&(i.symbol=h),i=a,i&&(i.symbol=W))});return{remove(){t.remove(),i&&(i.symbol=h)}}}function mo(o,t,e){return o.on("immediate-click",n=>{if(!i)return;n.stopPropagation();const r=i.geometry.centroid.clone();r.z+=y;const a=new b({geometry:r,symbol:new j({symbolLayers:[new B({resource:{primitive:"cylinder"},height:.5,width:3,depth:3,material:{color:"orange"}})]})});v.add(a),t.update(a),e()})}let J=[],x=[];function fo(o){o.on("update",t=>{var p;const e=(p=t.toolEventInfo)==null?void 0:p.type;if(e!=="move"&&e!=="move-start"&&e!=="move-stop")return;const n=t.graphics[0],r=n.geometry;e==="move-start"&&(J=po(n),x=r.rings[0][0].slice());const a=r.rings[0][0][0]-x[0],c=r.rings[0][0][1]-x[1];for(const w of J){const g=w.geometry.clone();for(const I of g.rings[0])I[0]+=a,I[1]+=c;w.floor.geometry=g}})}function po(o){const t=o.geometry;return s.graphics.filter(n=>n!==o&&K(t,n.geometry)).map(n=>({floor:n,geometry:n.geometry.clone()})).toArray()}const S=new X({container:"viewDiv",map:new Y({basemap:"satellite",ground:"world-elevation",layers:[m]}),camera:{position:{x:11.60221431,y:48.13713065,z:634.40014},heading:326.97,tilt:59.79},qualityProfile:"high"});window.view=S;oo(S);to();ro(S);ao();so(S);fo(u);
