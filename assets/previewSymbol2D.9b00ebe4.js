var R=Object.defineProperty,W=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var E=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,S=(t,e)=>{for(var i in e||(e={}))U.call(e,i)&&E(t,i,e[i]);if(Z)for(var i of Z(e))G.call(e,i)&&E(t,i,e[i]);return t},j=(t,e)=>W(t,B(e));import{r3 as k,ft as p,rq as I,rr as J,b7 as K,V as N,r6 as O,rs as V,ri as Q,ag as X}from"./vendor.1dc52be5.js";import{l as Y}from"./renderUtils.3228987e.js";const D="picture-fill",_="picture-marker",$="simple-fill",ee="simple-line",te="simple-marker",le="text",ae="Aa",ne=k.size,L=k.maxSize,H=k.maxOutlineSize,oe=k.lineWidth,ie=document.createElement("canvas");function se(t,e){const i=ie.getContext("2d"),f=[];return e&&(e.weight&&f.push(e.weight),e.size&&f.push(e.size+"px"),e.family&&f.push(e.family)),i.font=f.join(" "),i.measureText(t).width}const ue=7.2/2.54,ce=72/2.54;function me(t){if(t.length===0)return 0;if(t.length>2){const e=X(1),i=parseFloat(t);switch(t.slice(-2)){case"px":return i;case"pt":return i*e;case"in":return 72*i*e;case"pc":return 12*i*e;case"mm":return i*ue*e;case"cm":return i*ce*e}}return parseFloat(t)}function T(t){const e=t==null?void 0:t.size;return{width:e!=null&&typeof e=="object"&&"width"in e?p(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?p(e.height):null}}function pe(t,e){var i,f;const C=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,h=C!=null?p(C):null,g=(e==null?void 0:e.maxSize)!=null?p(e.maxSize):null,A=(e==null?void 0:e.opacity)!=null?e.opacity:null,y=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in t?t.angle:null,v=I(t);let d=J(t);if(v&&!d){const o="type"in v?null:new K(v);(o?o.toHex():null)==="#ffffff"&&(d={color:"#bdc3c7",width:.75})}const u={shape:null,fill:null,stroke:d,offset:[0,0]};(i=d)!=null&&i.width&&(d.width=Math.min(d.width,H));const c=((f=d)==null?void 0:f.width)||0;let r=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),l=0,a=0,w=!1;switch(t.type){case te:{const o=t.style,s=Math.min(h!=null?h:p(t.size),g||L);switch(l=s,a=s,o){case"circle":u.shape={type:"circle",cx:0,cy:0,r:.5*s},r||(l+=c,a+=c);break;case"cross":u.shape={type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[l,.5*a]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,a]}]};break;case"diamond":u.shape={type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*a]},{command:"L",values:[.5*l,a]},{command:"Z",values:[]}]},r||(l+=c,a+=c);break;case"square":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},r||(l+=c,a+=c),y&&(w=!0);break;case"triangle":u.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},r||(l+=c,a+=c),y&&(w=!0);break;case"x":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,a]},{command:"M",values:[l,0]},{command:"L",values:[0,a]}]},y&&(w=!0);break;case"path":u.shape={type:"path",path:t.path||""},r||(l+=c,a+=c),y&&(w=!0),r=!0}break}case ee:{var F;const{width:o,height:s}=T(e),n=s!=null?s:Math.min(h!=null?h:c,g||H),m=o!=null?o:oe;d.width=n,l=m,a=n;const M=(u==null||(F=u.stroke)==null?void 0:F.cap)||"butt",x=M==="round";r=!0,u.stroke.cap=M==="butt"?"square":M,u.shape={type:"path",path:[{command:"M",values:[x?n/2:0,a/2]},{command:"L",values:[x?l-n/2:l,a/2]}]};break}case D:case $:{const o=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:s,height:n}=T(e);l=o&&s!=null?s:h!=null?h:ne,a=o&&n!=null?n:l,r||(l+=c,a+=c),r=!0,u.shape=o?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,a]},{command:"L",values:[0,a]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:Q.fill[0];break}case _:{let o=p(t.width),s=p(t.height);const n=h!=null?h:Math.max(o,s),m=o/s;o=m<=1?Math.ceil(n*m):n,s=m<=1?n:Math.ceil(n/m),l=Math.min(o,g||L),a=Math.min(s,g||L),u.shape={type:"image",x:-Math.round(l/2),y:-Math.round(a/2),width:l,height:a,src:t.url||""},y&&(w=!0);break}case le:{const o=t,s=o.text||ae,n=o.font,m=Math.min(h!=null?h:p(n.size),g||L),M=se(s,{weight:n.weight,size:m,family:n.family}),x=/[\uE600-\uE6FF]/.test(s);l=x?m:M,a=m;let P=.25*me((n?m:0).toString());x&&(P+=5),u.shape={type:"text",text:s,x:0,y:P,align:"middle",decoration:n&&n.decoration,rotated:o.rotated,kerning:o.kerning},u.font=n&&{size:m,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family};break}}if(!u.shape)return Promise.reject(new N("symbolPreview: renderPreviewHTML2D","symbol not supported."));const b=v,q=t.color;let z=null;return b&&b.type==="pattern"&&q&&t.type!==D?z=O(b.src,q.toCss(!0)).then(o=>(b.src=o,u.fill=b,u)):(u.fill=v,z=Promise.resolve(u)),z.then(o=>{const s=[[o]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.applyColorModulation){const n=.6*l;s.unshift([j(S({},o),{offset:[-n,0],fill:V(v,-.3)})]),s.push([j(S({},o),{offset:[n,0],fill:V(v,.3)})]),l+=2*n,r=!1}return Y(s,[l,a],{node:e&&e.node,scale:r,opacity:A,rotation:y,useRotationSize:w,effectView:e==null?void 0:e.effectView})})}export{pe as previewSymbol2D};
