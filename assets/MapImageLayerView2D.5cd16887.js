var g=Object.defineProperty;var s=Object.getOwnPropertySymbols;var c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var p=(t,e,i)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,h=(t,e)=>{for(var i in e||(e={}))c.call(e,i)&&p(t,i,e[i]);if(s)for(var i of s(e))l.call(e,i)&&p(t,i,e[i]);return t};import{aM as u,ua as f,fJ as v,k8 as y,ac as o,ad as m,ae as w,fG as x}from"./vendor.1dc52be5.js";import{t as q}from"./BitmapContainer.ff87baf1.js";import{f as C}from"./LayerView2D.117f6ba5.js";import{r as U}from"./BaseGraphicContainer.875f1ac5.js";import{n as S}from"./HighlightGraphicContainer.ca09bc07.js";import{S as I}from"./ExportStrategy.18610da5.js";import{y as _}from"./MapImageLayerView.3bcb1be4.js";import{i as b}from"./RefreshableLayerView.3b33c0ca.js";import"./brushes.576aab26.js";import"./definitions.52b5fae8.js";import"./Utils.25ecb0e0.js";import"./enums.c01b5663.js";import"./number.dc47462b.js";import"./ProgramTemplate.baf6faf0.js";import"./StyleDefinition.57b891ae.js";import"./GeometryUtils.5ea26345.js";import"./MaterialKey.4c6f010e.js";import"./alignmentUtils.03ee467b.js";import"./WGLContainer.5147bf48.js";import"./Container.a479a20a.js";import"./EffectView.c4d390fc.js";import"./CIMSymbolHelper.e5777d0e.js";import"./BidiEngine.b9926823.js";import"./GeometryUtils.e53da643.js";import"./normalizeUtilsSync.74de1b64.js";import"./FeatureContainer.183e9c44.js";import"./visualVariablesUtils.7fd15dde.js";import"./visualVariablesUtils.2f752113.js";import"./TileContainer.c6767449.js";import"./Matcher.28a7d10a.js";import"./tileUtils.85af3d89.js";import"./TileClipper.95bbf067.js";import"./Geometry.e891c191.js";import"./cimAnalyzer.13178822.js";import"./ExpandedCIM.b5e8a891.js";import"./schemaUtils.64b2d47a.js";import"./createSymbolSchema.d85b2a0c.js";import"./MD5.67d7a872.js";import"./util.2009583e.js";import"./ComputedAttributeStorage.96ac9ebb.js";import"./GraphicsView.eb98715d.js";import"./Bitmap.2f97ffc8.js";import"./ExportImageParameters.70091022.js";import"./sublayerUtils.9294814a.js";import"./popupUtils.b61067f9.js";const M=u.getLogger("esri.views.2d.layers.MapImageLayerView2D");let r=class extends _(b(C(x))){constructor(){super(...arguments),this._highlightGraphics=new f}update(t){this.strategy.update(t).catch(e=>{v(e)||M.error(e)})}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:i}=this.layer,a=i>=10.3,n=i>=10;this._bitmapContainer=new q,this.container.addChild(this._bitmapContainer);const d=new U({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new S(this.view.featuresTilingScheme)});this.container.addChild(d.container),this.strategy=new I({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:a,imageNormalizationSupported:n,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion"),this.handles.add(this.watch("view.floors",()=>this.requestUpdate()),"view.floors"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(t,e){return this._highlightGraphics.add(t),{remove:()=>{this._highlightGraphics.remove(t)}}}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}createFetchPopupFeaturesQueryGeometry(t,e){return y(t,e,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,a){return this.layer.fetchImage(t,e,i,h({timeExtent:this.timeExtent,floors:this.view.floors},a))}};o([m()],r.prototype,"strategy",void 0),o([m()],r.prototype,"updating",void 0),r=o([w("esri.views.2d.layers.MapImageLayerView2D")],r);const qt=r;export{qt as default};
