var v=Object.defineProperty,C=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var d=(t,i,e)=>i in t?v(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,c=(t,i)=>{for(var e in i||(i={}))S.call(i,e)&&d(t,e,i[e]);if(u)for(var e of u(i))w.call(i,e)&&d(t,e,i[e]);return t},y=(t,i)=>C(t,V(i));import{ac as n,ad as a,ae as x,b1 as E,cP as G,a8 as o,fI as O,fJ as A,aa as h,fK as j,fL as _,fM as P,fN as R,fO as p,fP as I,g,n as H,aH as f,c as $,fQ as D,a9 as U,fR as L,fS as q}from"./vendor.1dc52be5.js";import{b as z,L as B}from"./Graphics3DScaleVisibility.f650aec4.js";import{d as M,l as T,s as k}from"./Graphics3DObjectStates.9abed703.js";let r=class extends E{constructor(t){super(t),this.type="graphics-3d",this.graphicsCore=null,this.elevationAlignment=new M,this._suspendResumeExtent=null}normalizeCtorArgs(t){const i=y(c({},t),{scaleVisibility:null,frustumVisibility:null});return delete i.scaleVisibilityEnabled,delete i.frustumVisibilityEnabled,t.scaleVisibilityEnabled&&(i.scaleVisibility=new z),t.frustumVisibilityEnabled&&(i.frustumVisibility=new T),i}initialize(){const t=new B({owner:this,layer:this.owner.layer,preferredUpdatePolicy:G.SYNC,graphicSymbolSupported:!0});this._set("graphicsCore",t);const{layer:i,scaleVisibility:e}=this;if(o(e)&&"effectiveScaleRange"in i){const s=i;this.updatingHandles.add(()=>s.effectiveScaleRange,()=>e.layerMinMaxScaleChangeHandler())}if("fullOpacity"in this.owner){const s=this.owner;this.updatingHandles.add(()=>s.fullOpacity,()=>this.graphicsCore.opacityChange())}if("elevationInfo"in i){const s=i;this.updatingHandles.add(()=>s.elevationInfo,(l,m)=>{O(l,m)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})}}async setup(){const t=(i,e,s)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(i,e,s);if(this.elevationAlignment.setup(this,t,this.graphicsCore,this.view.elevationProvider),o(this.scaleVisibility)&&"effectiveScaleRange"in this.layer){const i=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this,this.layer,t,this.graphicsCore,i)}o(this.frustumVisibility)&&this.frustumVisibility.setup(this),this._set("objectStates",new k(this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(i){if(A(i))return;throw i}this.destroyed||(this.handles.add(this.view.watch("clippingArea",()=>this._updateClippingExtent(),!0)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("elevationAlignment",h(this.elevationAlignment)),this._set("scaleVisibility",h(this.scaleVisibility)),this._set("frustumVisibility",h(this.frustumVisibility)),this._set("objectStates",h(this.objectStates)),this._set("graphicsCore",h(this.graphicsCore))}get layer(){return this.owner.layer}get view(){return this.owner.view}get scaleVisibilitySuspended(){return!(!o(this.scaleVisibility)||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return!(!o(this.frustumVisibility)||!this.frustumVisibility.suspended)}get suspended(){var t;return(t=this.owner.suspended)!=null&&t}get updating(){var t;return!!((t=this.graphicsCore)!=null&&t.updating||o(this.scaleVisibility)&&this.scaleVisibility.updating||o(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles.updating)}get graphics3DGraphics(){var t;return(t=this.graphicsCore)==null?void 0:t.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var t;return(t=this.graphicsCore)==null?void 0:t.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){var t;return(t=this.owner.fullOpacity)!=null?t:1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get drapeSourceType(){return this.owner.drapeSourceType}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(t){this.graphicsCore.notifyGraphicGeometryChanged(t)}notifyGraphicVisibilityChanged(t){this.graphicsCore.notifyGraphicVisibilityChanged(t)}getRenderingInfo(t,i,e){const s=j(t,{renderer:i,arcade:e});if(o(s)&&s.color){const l=s.color;l[0]=l[0]/255,l[1]=l[1]/255,l[2]=l[2]/255}return s}getRenderingInfoAsync(t,i,e,s){return _(t,c({renderer:i,arcade:e},s))}getGraphicFromGraphicUid(t){if(this.owner.loadedGraphics){const i=this.owner.loadedGraphics.find(e=>e.uid===t);if(i){const e=this.layer instanceof P?this.layer:null;return R(i,e)}}}whenGraphicBounds(t,i){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(t,i):Promise.reject()}computeAttachmentOrigin(t,i){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(t,i):null}getSymbolLayerSize(t,i){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(t,i):null}maskOccludee(t){const{set:i,handle:e}=this.objectStates.acquireSet(p.MaskOccludee,null);return this.objectStates.setUid(i,t.uid),e}highlight(t){if(t instanceof I)return b;if(typeof t=="number")return this.highlight([t]);if(t instanceof g)return this.highlight([t]);if(t instanceof H&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof g){const i=t.map(l=>l.uid),{set:e,handle:s}=this.objectStates.acquireSet(p.Highlight,null);return this.objectStates.setUids(e,i),s}if(typeof t[0]=="number"){const i=t,{set:e,handle:s}=this.objectStates.acquireSet(p.Highlight,null);return this.objectStates.setObjectIds(e,i),s}}return b}_setupSuspendResumeExtent(){const{scaleVisibility:t,frustumVisibility:i}=this;if(f(t)&&f(i))return;const e=({computedExtent:s,extentPadding:l})=>{this._suspendResumeExtent=L(s,this._suspendResumeExtent,q,l),o(t)&&t.setExtent(this._suspendResumeExtent),o(i)&&i.setExtent(this._suspendResumeExtent)};this.handles.add($(()=>{var s,l;return{computedExtent:(s=this.graphicsCore)==null?void 0:s.computedExtent,extentPadding:(l=this.graphicsCore)==null?void 0:l.extentPadding}},s=>e(s),D))}_updateClippingExtent(){const t=this.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};n([a()],r.prototype,"type",void 0),n([a({constructOnly:!0})],r.prototype,"owner",void 0),n([a()],r.prototype,"layer",null),n([a()],r.prototype,"view",null),n([a({constructOnly:!0})],r.prototype,"graphicsCore",void 0),n([a({constructOnly:!0})],r.prototype,"scaleVisibility",void 0),n([a({constructOnly:!0})],r.prototype,"frustumVisibility",void 0),n([a({readOnly:!0})],r.prototype,"elevationAlignment",void 0),n([a({readOnly:!0})],r.prototype,"objectStates",void 0),n([a({readOnly:!0})],r.prototype,"scaleVisibilitySuspended",null),n([a({readOnly:!0})],r.prototype,"frustumVisibilitySuspended",null),n([a()],r.prototype,"suspended",null),n([a({readOnly:!0})],r.prototype,"updating",null),n([a()],r.prototype,"loadedGraphics",null),n([a()],r.prototype,"fullOpacity",null),n([a()],r.prototype,"slicePlaneEnabled",null),n([a()],r.prototype,"drapeSourceType",null),n([a()],r.prototype,"updatePolicy",null),r=n([x("esri.views.3d.layers.graphics.GraphicsProcessor")],r);const b=U();export{r as O};
