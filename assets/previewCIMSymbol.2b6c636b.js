import{r3 as C,rt as S,ru as v,ag as x}from"./vendor.1dc52be5.js";import{CIMSymbolRasterizer as I}from"./CIMSymbolRasterizer.f7f1c33f.js";import{l as D}from"./renderUtils.3228987e.js";import"./cimAnalyzer.13178822.js";import"./CIMSymbolHelper.e5777d0e.js";import"./BidiEngine.b9926823.js";import"./enums.c01b5663.js";import"./alignmentUtils.03ee467b.js";import"./definitions.52b5fae8.js";import"./number.dc47462b.js";import"./GeometryUtils.e53da643.js";import"./Rasterizer.44ed8c8f.js";const V=new I(null,!0),O=C.maxSize;async function q(e,t={}){const{size:s,maxSize:u,node:y,opacity:f}=t,g=t.cimOptions||t,{feature:w,fieldMap:M,geometryType:b,style:z}=g,h=S(e),d=typeof s=="number"?s:null,i=Math.min(d!=null?d:h,u!=null?u:x(O));i!==h&&(e=e.clone(),v(e,i,{preserveOutlineWidth:!0}));let n=3;e&&e.data&&e.data.symbol&&e.data.symbol.type!=="CIMPointSymbol"&&(n=1);const c=await V.rasterizeCIMSymbolAsync(e,w,M,b,{scaleFactor:n,style:z}),l=document.createElement("canvas");l.width=c.imageData.width,l.height=c.imageData.height,l.getContext("2d").putImageData(c.imageData,0,0);let a=l.width/n,r=l.height/n;if(s!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale))){const o=a/r;a=o<=1?Math.ceil(i*o):i,r=o<=1?i:Math.ceil(i/o)}const m=new Image(a,r);m.src=l.toDataURL(),f!=null&&(m.style.opacity=`${f}`);let p=m;if(t.effectView!=null){const o={shape:{type:"image",x:0,y:0,width:a,height:r,src:m.src},fill:null,stroke:null,offset:[0,0]};p=D([[o]],[a,r],{effectView:t.effectView})}return y&&y.appendChild(p),p}export{q as previewCIMSymbol};
