import{v as H,ai as U,j as y,ab as et,a5 as k,h4 as X,af as it,aS as st,u as at,bQ as R,bP as T,bR as D,gy as rt,h6 as O,aa as ht,g as I,a8 as ot,ac as g,ad as _,ae as ct,h1 as nt}from"./vendor.1dc52be5.js";import{s as b,i as L,a as lt,m as pt}from"./drawUtils.a0bb65f2.js";import{h as dt,T as gt}from"./GraphicMover.9f0e19b3.js";import{h as ut}from"./settings.e8b6f524.js";import"./GraphicManipulator.8bfda6fd.js";function V(t){let e=0,i=0;const s=t.length;let a,r=t[i];for(i=0;i<s-1;i++)a=t[i+1],e+=(a[0]-r[0])*(a[1]+r[1]),r=a;return e>=0}function $(t,e,i,s){const a=[];for(const r of t){const o=r.slice(0);a.push(o);const n=e*(r[0]-s.x)-i*(r[1]-s.y)+s.x,h=i*(r[0]-s.x)+e*(r[1]-s.y)+s.y;o[0]=n,o[1]=h}return a}function z(t,e,i){const s=t.spatialReference,a=e*Math.PI/180,r=Math.cos(a),o=Math.sin(a);var n,h;if("xmin"in t&&(i=(n=i)!=null?n:t.center,t=new H({spatialReference:s,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})),"paths"in t){var l;i=(l=i)!=null?l:t.extent.center;const v=[];for(const m of t.paths)v.push($(m,r,o,i));return new U({spatialReference:s,paths:v})}if("rings"in t){var c;i=(c=i)!=null?c:t.extent.center;const v=[];for(const m of t.rings){const B=V(m),x=$(m,r,o,i);V(x)!==B&&x.reverse(),v.push(x)}return new H({spatialReference:s,rings:v})}if("x"in t){var d;i=(d=i)!=null?d:t;const v=new y({x:r*(t.x-i.x)-o*(t.y-i.y)+i.x,y:o*(t.x-i.x)+r*(t.y-i.y)+i.y,spatialReference:s});return t.z!=null&&(v.z=t.z),t.m!=null&&(v.m=t.m),v}return"points"in t?(i=(h=i)!=null?h:t.extent.center,new et({points:$(t.points,r,o,i),spatialReference:s})):null}class _t{constructor(e,i,s,a){this.graphics=e,this.mover=i,this.dx=s,this.dy=a,this.type="move-start"}}class vt{constructor(e,i,s,a){this.graphics=e,this.mover=i,this.dx=s,this.dy=a,this.type="move"}}class mt{constructor(e,i,s,a){this.graphics=e,this.mover=i,this.dx=s,this.dy=a,this.type="move-stop"}}class yt{constructor(e,i,s){this.graphics=e,this.mover=i,this.angle=s,this.type="rotate-start"}}class Gt{constructor(e,i,s){this.graphics=e,this.mover=i,this.angle=s,this.type="rotate"}}class ft{constructor(e,i,s){this.graphics=e,this.mover=i,this.angle=s,this.type="rotate-stop"}}class bt{constructor(e,i,s,a){this.graphics=e,this.mover=i,this.xScale=s,this.yScale=a,this.type="scale-start"}}class St{constructor(e,i,s,a){this.graphics=e,this.mover=i,this.xScale=s,this.yScale=a,this.type="scale"}}class wt{constructor(e,i,s,a){this.graphics=e,this.mover=i,this.xScale=s,this.yScale=a,this.type="scale-stop"}}const u=ut.transformGraphics,w={centerIndicator:new k({style:"cross",size:u.center.size,color:u.center.color}),fill:{default:new X({color:u.fill.color,outline:{color:u.fill.outlineColor,join:"round",width:1}}),active:new X({color:u.fill.stagedColor,outline:{color:u.fill.outlineColor,join:"round",style:"dash",width:1}})},handles:{default:new k({style:"square",size:u.vertex.size,color:u.vertex.color,outline:{color:u.vertex.outlineColor,width:1}}),hover:new k({style:"square",size:u.vertex.hoverSize,color:u.vertex.hoverColor,outline:{color:u.vertex.hoverOutlineColor,width:1}})},rotator:{default:new k({style:"circle",size:u.vertex.size,color:u.vertex.color,outline:{color:u.vertex.outlineColor,width:1}}),hover:new k({style:"circle",size:u.vertex.hoverSize,color:u.vertex.hoverColor,outline:{color:u.vertex.hoverOutlineColor,width:1}})},rotatorLine:new it({color:u.line.color,width:1})};let p=class extends st.EventedAccessor{constructor(t){super(t),this._activeHandleGraphic=null,this._graphicAttributes={esriSketchTool:"box"},this._handles=new at,this._mover=null,this._rotateGraphicOffset=20,this._angleOfRotation=0,this._rotateLineGraphic=null,this._startInfo=null,this._totalDx=0,this._totalDy=0,this._xScale=1,this._yScale=1,this.type="box",this.callbacks={onMoveStart(){},onMove(){},onMoveStop(){},onScaleStart(){},onScale(){},onScaleStop(){},onRotateStart(){},onRotate(){},onRotateStop(){},onGraphicClick(){}},this.centerGraphic=null,this.backgroundGraphic=null,this.enableMovement=!0,this.enableRotation=!0,this.enableScaling=!0,this.graphics=[],this.handleGraphics=[],this.layer=null,this.preserveAspectRatio=!1,this.rotateGraphic=null,this.showCenterGraphic=!0,this.view=null,this._getBounds=(()=>{const e=R();return(i,s)=>{i[0]=Number.POSITIVE_INFINITY,i[1]=Number.POSITIVE_INFINITY,i[2]=Number.NEGATIVE_INFINITY,i[3]=Number.NEGATIVE_INFINITY;for(const a of s){if(!a)continue;let r,o,n,h;if(a.type==="point")r=n=a.x,o=h=a.y;else if(a.type==="multipoint"){const l=T(a);[r,o,n,h]=D(e,[l])}else if(a.type==="extent")[r,o,n,h]=[a.xmin,a.ymin,a.xmax,a.ymax];else{const l=T(a);[r,o,n,h]=D(e,l)}i[0]=Math.min(r,i[0]),i[1]=Math.min(o,i[1]),i[2]=Math.max(n,i[2]),i[3]=Math.max(h,i[3])}return i}})()}initialize(){this._highlightHelper=new dt({view:this.view}),this._setup(),this._handles.add([rt(this,"view.ready",()=>{const{layer:t,view:e}=this;nt(e,t)}),O(this,"preserveAspectRatio",()=>{this._activeHandleGraphic&&(this._scaleGraphic(this._activeHandleGraphic),this._updateGraphics())}),O(this,"view.scale",()=>{this._updateRotateGraphic(),this._updateRotateLineGraphic()}),O(this,"graphics",()=>this.refresh()),O(this,"layer",(t,e)=>{e&&this._resetGraphics(e),this.refresh()})])}destroy(){this._reset(),this._handles=ht(this._handles)}set highlightsEnabled(t){var e;(e=this._highlightHelper)==null||e.removeAll(),this._set("highlightsEnabled",t),this._setUpHighlights()}get state(){const t=!!this.get("view.ready"),e=!(!this.get("graphics.length")||!this.get("layer"));return t&&e?"active":t?"ready":"disabled"}set symbols(t){const{centerIndicator:e=w.centerIndicator,fill:i=w.fill,handles:s=w.handles,rotator:a=w.rotator,rotatorLine:r=w.rotatorLine}=t||{};this._set("symbols",{centerIndicator:e,fill:i,handles:s,rotator:a,rotatorLine:r})}isUIGraphic(t){let e=[];return this.handleGraphics.length&&(e=e.concat(this.handleGraphics)),this.backgroundGraphic&&e.push(this.backgroundGraphic),this.centerGraphic&&e.push(this.centerGraphic),this.rotateGraphic&&e.push(this.rotateGraphic),this._rotateLineGraphic&&e.push(this._rotateLineGraphic),e.length&&e.includes(t)}move(t,e){if(this._mover&&this.graphics.length){for(const i of this.graphics){const s=i.geometry,a=b(s,t,e,this.view);i.geometry=a}this.refresh(),this._emitMoveStopEvent(t,e,null)}}scale(t,e){if(this._mover&&this.graphics.length){for(const i of this.graphics){const s=i.geometry,a=L(s,t,e);i.geometry=a}this.refresh(),this._emitScaleStopEvent(t,e,null)}}rotate(t,e){if(this._mover&&this.graphics.length){if(!e){const i=this.handleGraphics[1].geometry.x,s=this.handleGraphics[3].geometry.y;e=new y(i,s,this.view.spatialReference)}for(const i of this.graphics){const s=i.geometry,a=z(s,t,e);i.geometry=a}this.refresh(),this._emitRotateStopEvent(t,null)}}refresh(){this._reset(),this._setup()}reset(){this.graphics=[]}_setup(){this.state==="active"&&(this._setUpHighlights(),this._setupGraphics(),this._setupMover(),this._updateGraphics())}_reset(){this._highlightHelper.removeAll(),this._resetGraphicStateVars(),this._resetGraphics(),this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}_resetGraphicStateVars(){this._startInfo=null,this._activeHandleGraphic=null,this._totalDx=0,this._totalDy=0,this._xScale=1,this._yScale=1,this._angleOfRotation=0}_resetGraphics(t){const e=t||this.layer;e&&(e.removeMany(this.handleGraphics),e.remove(this.backgroundGraphic),e.remove(this.centerGraphic),e.remove(this.rotateGraphic),e.remove(this._rotateLineGraphic));for(const i of this.handleGraphics)i.destroy();this._set("handleGraphics",[]),this.backgroundGraphic&&(this.backgroundGraphic.destroy(),this._set("backgroundGraphic",null)),this.centerGraphic&&(this.centerGraphic.destroy(),this._set("centerGraphic",null)),this.rotateGraphic&&(this.rotateGraphic.destroy(),this._set("rotateGraphic",null)),this._rotateLineGraphic&&(this._rotateLineGraphic.destroy(),this._rotateLineGraphic=null)}_setupMover(){let t=[];this.enableScaling&&(t=t.concat(this.handleGraphics)),this.enableMovement&&(t=t.concat(this.graphics,this.backgroundGraphic)),this.enableRotation&&t.push(this.rotateGraphic),this.showCenterGraphic&&t.push(this.centerGraphic),this._mover=new gt({enableMoveAllGraphics:!1,highlightsEnabled:!1,indicatorsEnabled:!1,view:this.view,graphics:t,callbacks:{onGraphicClick:e=>this._onGraphicClickCallback(e),onGraphicMoveStart:e=>this._onGraphicMoveStartCallback(e),onGraphicMove:e=>this._onGraphicMoveCallback(e),onGraphicMoveStop:e=>this._onGraphicMoveStopCallback(e),onGraphicPointerOver:e=>this._onGraphicPointerOverCallback(e),onGraphicPointerOut:e=>this._onGraphicPointerOutCallback(e)}})}_getStartInfo(t){const[e,i,s,a]=this._getBoxBounds(R()),r=Math.abs(s-e),o=Math.abs(a-i),n=(s+e)/2,h=(a+i)/2,{x:l,y:c}=t.geometry;return{width:r,height:o,centerX:n,centerY:h,startX:l,startY:c,graphicInfos:this._getGraphicInfos(),box:this.backgroundGraphic.geometry,rotate:this.rotateGraphic.geometry}}_getGraphicInfos(){return this.graphics.map(t=>this._getGraphicInfo(t))}_getGraphicInfo(t){const e=t.geometry,[i,s,a,r]=this._getBounds(R(),[e]);return{width:Math.abs(a-i),height:Math.abs(r-s),centerX:(a+i)/2,centerY:(r+s)/2,geometry:e}}_onGraphicClickCallback(t){t.viewEvent.stopPropagation(),this.emit("graphic-click",t),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(t)}_onGraphicMoveStartCallback(t){const{_angleOfRotation:e,_xScale:i,_yScale:s,backgroundGraphic:a,handleGraphics:r,rotateGraphic:o,symbols:n}=this,h=t.graphic;this._resetGraphicStateVars(),this._hideGraphicsBeforeUpdate(),a.symbol=n.fill.active,this._startInfo=this._getStartInfo(h),h===o?(this.view.cursor="grabbing",this._emitRotateStartEvent(e,h)):r.includes(h)?(this._activeHandleGraphic=h,this._emitScaleStartEvent(i,s,h)):this._emitMoveStartEvent(t.dx,t.dy,h)}_onGraphicMoveCallback(t){const e=t.graphic;if(this._startInfo)if(this.handleGraphics.includes(e))this._scaleGraphic(e),this._emitScaleEvent(this._xScale,this._yScale,e);else if(e===this.rotateGraphic)this._rotateGraphic(e),this._emitRotateEvent(this._angleOfRotation,e);else{const i=t.dx,s=t.dy;this._totalDx+=i,this._totalDy+=s,this._moveGraphic(e,i,s),this._emitMoveEvent(i,s,e)}}_onGraphicMoveStopCallback(t){const e=t.graphic;if(!this._startInfo)return void this.refresh();const{_angleOfRotation:i,_totalDx:s,_totalDy:a,_xScale:r,_yScale:o,handleGraphics:n,rotateGraphic:h}=this;this.refresh(),e===h?(this.view.cursor="pointer",this._emitRotateStopEvent(i,e)):n.includes(e)?this._emitScaleStopEvent(r,o,e):this._emitMoveStopEvent(s,a,e)}_onGraphicPointerOverCallback(t){const{backgroundGraphic:e,handleGraphics:i,graphics:s,rotateGraphic:a,symbols:r,view:o}=this,n=t.graphic;if(n===a)return a.symbol=r.rotator.hover,void(o.cursor="pointer");if(s.includes(n)||n===e)return void(o.cursor="move");if(!i.includes(n))return void(o.cursor="pointer");t.graphic.symbol=r.handles.hover;const h=o.rotation;let l,c=t.index;switch(c<8&&(h>=0&&h<45?c%=8:c=h>=45&&h<90?(c+1)%8:h>=90&&h<135?(c+2)%8:h>=135&&h<180?(c+3)%8:h>=180&&h<225?(c+4)%8:h>=225&&h<270?(c+5)%8:h>=270&&h<315?(c+6)%8:(c+7)%8),c){case 0:case 4:l="nwse-resize";break;case 1:case 5:l="ns-resize";break;case 2:case 6:l="nesw-resize";break;case 3:case 7:l="ew-resize";break;default:l="pointer"}o.cursor=l}_onGraphicPointerOutCallback(t){const{handleGraphics:e,rotateGraphic:i,symbols:s,view:a}=this;t.graphic===i?i.symbol=s.rotator.default:e.includes(t.graphic)&&(t.graphic.symbol=s.handles.default),a.cursor="default"}_scaleGraphic(t){const{_startInfo:e,handleGraphics:i,preserveAspectRatio:s,view:a}=this,{centerX:r,centerY:o,startX:n,startY:h}=e,{resolution:l,transform:c}=a.state,d=i.indexOf(t);d!==1&&d!==5||this._updateX(t,r),d!==3&&d!==7||this._updateY(t,o);const{x:v,y:m}=t.geometry,B=c[0]*v+c[2]*m+c[4],x=c[1]*v+c[3]*m+c[5],M=e.graphicInfos.map(S=>S.geometry);if(s){const S=c[0]*r+c[2]*o+c[4],E=c[1]*r+c[3]*o+c[5],G=c[0]*n+c[2]*h+c[4],f=c[1]*n+c[3]*h+c[5];this._xScale=this._yScale=lt(S,E,G,f,B,x);for(const C of M){const Y=M.indexOf(C);this.graphics[Y].geometry=L(C,this._xScale,this._yScale,[r,o])}this._updateBackgroundGraphic()}else{const{width:S,height:E}=e;let G=v-n,f=h-m;if(d===1||d===5?G=0:d!==3&&d!==7||(f=0),G===0&&f===0)return;const C=S+(n>r?G:-1*G),Y=E+(h<o?f:-1*f),j=r+G/2,F=o+f/2;this._xScale=C/S||1,this._yScale=Y/E||1,d===1||d===5?this._xScale=1:d!==3&&d!==7||(this._yScale=1);const q=(j-r)/l,Q=(F-o)/l,J=L(e.box,this._xScale,this._yScale);this.backgroundGraphic.geometry=b(J,q,Q,a,!0);const{centerX:N,centerY:A}=this._getGraphicInfo(this.backgroundGraphic),K=(N-r)/l,W=-1*(A-o)/l;for(const P of M){const Z=M.indexOf(P),tt=L(P,this._xScale,this._yScale,[r,o]);this.graphics[Z].geometry=b(tt,K,W,a,!0)}this.centerGraphic.geometry=new y(N,A,a.spatialReference)}}_rotateGraphic(t){const{centerX:e,centerY:i,startX:s,startY:a,box:r,rotate:o}=this._startInfo,n=new y(s,a,this.view.spatialReference),h=new y(e,i,this.view.spatialReference),l=t.geometry;this._angleOfRotation=pt(n,l,h);const c=this._startInfo.graphicInfos.map(d=>d.geometry);for(const d of c){const v=c.indexOf(d),m=z(d,this._angleOfRotation,h);this.graphics[v].geometry=m}this.backgroundGraphic.geometry=z(r,this._angleOfRotation,h),this.rotateGraphic.geometry=z(o,this._angleOfRotation,h)}_moveGraphic(t,e,i){if(this.graphics.includes(t)){const s=this.backgroundGraphic.geometry;this.backgroundGraphic.geometry=b(s,e,i,this.view);for(const a of this.graphics)a!==t&&(a.geometry=b(a.geometry,e,i,this.view))}else if(t===this.centerGraphic){const s=this.backgroundGraphic.geometry;this.backgroundGraphic.geometry=b(s,e,i,this.view)}if(t===this.backgroundGraphic||t===this.centerGraphic)for(const s of this.graphics)s.geometry=b(s.geometry,e,i,this.view)}_setUpHighlights(){var t,e;this.highlightsEnabled&&(t=this.graphics)!=null&&t.length&&((e=this._highlightHelper)==null||e.add(this.graphics))}_setupGraphics(){const{_graphicAttributes:t,symbols:e}=this;this._set("centerGraphic",new I(null,e.centerIndicator,t)),this.showCenterGraphic&&this.layer.add(this.centerGraphic),this._set("backgroundGraphic",new I(null,e.fill.default,t)),this.layer.add(this.backgroundGraphic),this._rotateLineGraphic=new I(null,e.rotatorLine,t),this._set("rotateGraphic",new I(null,e.rotator.default,t)),this.enableRotation&&!this._hasExtentGraphic()&&(this.layer.add(this._rotateLineGraphic),this.layer.add(this.rotateGraphic));for(let i=0;i<8;i++)this.handleGraphics.push(new I(null,e.handles.default,t));this.enableScaling&&this.layer.addMany(this.handleGraphics)}_updateGraphics(){this._updateBackgroundGraphic(),this._updateHandleGraphics(),this._updateCenterGraphic(),this._updateRotateGraphic(),this._updateRotateLineGraphic()}_hideGraphicsBeforeUpdate(){this.centerGraphic.visible=!1,this.rotateGraphic.visible=!1,this._rotateLineGraphic.visible=!1,this.handleGraphics.forEach(t=>t.visible=!1)}_updateHandleGraphics(){const t=this._getCoordinates(!0);this.handleGraphics.forEach((e,i)=>{const[s,a]=t[i];this._updateXY(e,s,a)})}_updateBackgroundGraphic(){const t=this._getCoordinates();this.backgroundGraphic.geometry=new H({rings:t,spatialReference:this.view.spatialReference})}_updateCenterGraphic(){const[t,e,i,s]=this._getBoxBounds(R()),a=(i+t)/2,r=(s+e)/2;this.centerGraphic.geometry=new y(a,r,this.view.spatialReference)}_updateRotateGraphic(){if(!this.handleGraphics.length)return;const{x:t,y:e}=this.handleGraphics[1].geometry,i=e+this.view.state.resolution*this._rotateGraphicOffset;this.rotateGraphic.geometry=new y(t,i,this.view.spatialReference)}_updateRotateLineGraphic(){if(!this.handleGraphics.length||!this.rotateGraphic||!this.rotateGraphic.geometry)return;const t=this.handleGraphics[1].geometry,e=this.rotateGraphic.geometry;this._rotateLineGraphic.geometry=new U({paths:[[t.x,t.y],[e.x,e.y]],spatialReference:this.view.spatialReference})}_updateXY(t,e,i){t.geometry=new y(e,i,this.view.spatialReference)}_updateX(t,e){const i=t.geometry.y;t.geometry=new y(e,i,this.view.spatialReference)}_updateY(t,e){const i=t.geometry.x;t.geometry=new y(i,e,this.view.spatialReference)}_hasExtentGraphic(){return this.graphics.some(t=>t&&ot(t.geometry)&&t.geometry.type==="extent")}_getBoxBounds(t){const e=this.graphics.map(i=>i.geometry);return this._getBounds(t,e)}_getCoordinates(t){const[e,i,s,a]=this._getBoxBounds(R());if(t){const r=(e+s)/2,o=(a+i)/2;return[[e,a],[r,a],[s,a],[s,o],[s,i],[r,i],[e,i],[e,o]]}return[[e,a],[s,a],[s,i],[e,i]]}_emitMoveStartEvent(t,e,i){const s=new _t(this.graphics,i,t,e);this.emit("move-start",s),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(s)}_emitMoveEvent(t,e,i){const s=new vt(this.graphics,i,t,e);this.emit("move",s),this.callbacks.onMove&&this.callbacks.onMove(s)}_emitMoveStopEvent(t,e,i){const s=new mt(this.graphics,i,t,e);this.emit("move-stop",s),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(s)}_emitRotateStartEvent(t,e){const i=new yt(this.graphics,e,t);this.emit("rotate-start",i),this.callbacks.onRotateStart&&this.callbacks.onRotateStart(i)}_emitRotateEvent(t,e){const i=new Gt(this.graphics,e,t);this.emit("rotate",i),this.callbacks.onRotate&&this.callbacks.onRotate(i)}_emitRotateStopEvent(t,e){const i=new ft(this.graphics,e,t);this.emit("rotate-stop",i),this.callbacks.onRotateStop&&this.callbacks.onRotateStop(i)}_emitScaleStartEvent(t,e,i){const s=new bt(this.graphics,i,t,e);this.emit("scale-start",s),this.callbacks.onScaleStart&&this.callbacks.onScaleStart(s)}_emitScaleEvent(t,e,i){const s=new St(this.graphics,i,t,e);this.emit("scale",s),this.callbacks.onScale&&this.callbacks.onScale(s)}_emitScaleStopEvent(t,e,i){const s=new wt(this.graphics,i,t,e);this.emit("scale-stop",s),this.callbacks.onScaleStop&&this.callbacks.onScaleStop(s)}};g([_()],p.prototype,"_rotateLineGraphic",void 0),g([_({readOnly:!0})],p.prototype,"type",void 0),g([_()],p.prototype,"callbacks",void 0),g([_({readOnly:!0})],p.prototype,"centerGraphic",void 0),g([_({readOnly:!0})],p.prototype,"backgroundGraphic",void 0),g([_()],p.prototype,"enableMovement",void 0),g([_()],p.prototype,"enableRotation",void 0),g([_()],p.prototype,"enableScaling",void 0),g([_()],p.prototype,"graphics",void 0),g([_({readOnly:!0})],p.prototype,"handleGraphics",void 0),g([_({value:!0})],p.prototype,"highlightsEnabled",null),g([_()],p.prototype,"layer",void 0),g([_()],p.prototype,"preserveAspectRatio",void 0),g([_({readOnly:!0})],p.prototype,"rotateGraphic",void 0),g([_()],p.prototype,"showCenterGraphic",void 0),g([_({readOnly:!0})],p.prototype,"state",null),g([_({value:w})],p.prototype,"symbols",null),g([_()],p.prototype,"view",void 0),p=g([ct("esri.views.draw.support.Box")],p);const Et=p;export{Et as default};
